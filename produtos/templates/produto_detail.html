{% extends "base.html" %}

{% block title %}{{ produto.nome_produto }} - Detalhes{% endblock %}

{% block extra_css %}
<style>
  :root {
    --green-dark: #1f4f3a;
    --green-main: #256a4b;
    --bg-light: #faf9f7;
    --text-dark: #1d1d1d;
    --card-radius: 14px;
  }

  body { background-color: var(--bg-light); }

  .detail-wrapper {
    min-height: calc(100vh - 160px);
    display: grid;
    place-items: center;
    padding: 30px 16px 60px;
  }

  .detail-card {
    width: 100%;
    max-width: 1000px;
    background: #fff;
    border-radius: var(--card-radius);
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .detail-header {
    padding: 22px 24px;
    border-bottom: 1px solid #eee;
    display: flex;
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
  }

  .detail-header .thumb {
    width: 64px; height: 64px;
    border-radius: 10px;
    background: #f4f4f4;
    display: grid; place-items: center;
    overflow: hidden;
  }
  .detail-header .thumb img {
    width: 100%; height: 100%; object-fit: cover;
  }

  .detail-title {
    flex: 1;
  }
  .detail-title h2 {
    margin: 0;
    font-size: 20px;
    color: var(--text-dark);
  }
  .detail-title .meta {
    margin-top: 6px;
    font-size: 13px;
    color: #666;
  }

  .detail-actions {
    display: flex; gap: 10px; flex-wrap: wrap;
  }
  .btn {
    appearance: none;
    border: none;
    cursor: pointer;
    border-radius: 10px;
    padding: 10px 14px;
    font-weight: 600;
    transition: transform .05s ease, background .2s ease;
    text-decoration: none;
    display: inline-block;
  }
  .btn:active { transform: translateY(1px); }
  .btn-primary { background: var(--green-main); color: #fff; }
  .btn-primary:hover { background: var(--green-dark); }
  .btn-outline { background: transparent; color: var(--green-main); border: 1px solid var(--green-main); }
  .btn-outline:hover { background: #e7f3ee; }
  .btn-download { background: #3498db; color: #fff; }
  .btn-download:hover { background: #2980b9; }

  .detail-body {
    padding: 0;
  }

  /* Viewer responsivo de PDF/Imagem */
  .techsheet-viewer {
    width: 100%;
    min-height: 70vh;
    background: #f7f7f7;
    display: grid; place-items: center;
  }
  .techsheet-frame {
    width: 100%;
    height: 80vh;
    border: none;
  }
  .techsheet-img {
    width: 100%;
    height: auto;
    display: block;
    max-height: 80vh;
    object-fit: contain;
    background: #fff;
  }

  .empty-techsheet {
    padding: 40px 24px;
    text-align: center;
    color: #777;
  }

  .info-section {
    padding: 24px;
    border-bottom: 1px solid #eee;
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }

  .info-item {
    padding: 12px;
    background: #f9f9f9;
    border-radius: 8px;
  }

  .info-item label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .info-item span {
    display: block;
    margin-top: 4px;
    font-size: 15px;
    color: var(--text-dark);
    font-weight: 500;
  }

  @media (max-width: 768px) {
    .detail-header { padding: 16px; }
    .detail-title h2 { font-size: 18px; }
    .techsheet-frame { height: 70vh; }
    .info-grid { grid-template-columns: 1fr; }
  }
</style>
{% endblock %}

{% block content %}
<div class="detail-wrapper">
  <div class="detail-card">
    <!-- Cabe√ßalho -->
    <div class="detail-header">
      <div class="thumb">
        {% if produto.imagem %}
          <img src="{{ produto.imagem.url }}" alt="{{ produto.nome_produto }}">
        {% else %}
          <span style="font-size:12px; color:#888;">üì¶</span>
        {% endif %}
      </div>
      <div class="detail-title">
        <h2>{{ produto.nome_produto }}</h2>
        <div class="meta">
          {{ produto.marca }}{% if produto.especie %} ‚Äì {{ produto.especie }}{% endif %}
        </div>
      </div>

      <div class="detail-actions">
        {% if produto.ficha_tecnica_imagem %}
          <a class="btn btn-download" href="{{ produto.ficha_tecnica_imagem.url }}" download>
            ‚¨áÔ∏è Baixar Ficha T√©cnica
          </a>
        {% endif %}
        <a class="btn btn-primary" href="{% url 'lista_produtos' %}">
          ‚Üê Voltar √† lista
        </a>
      </div>
    </div>

    <!-- Informa√ß√µes do Produto -->
    <div class="info-section">
      <h3 style="margin: 0 0 8px 0; color: var(--text-dark);">Informa√ß√µes do Produto</h3>
      <div class="info-grid">
        <div class="info-item">
          <label>Marca</label>
          <span>{{ produto.marca }}</span>
        </div>
        <div class="info-item">
          <label>Esp√©cie</label>
          <span>{{ produto.especie }}</span>
        </div>
        <div class="info-item">
          <label>Divis√£o</label>
          <span>{{ produto.divisao }}</span>
        </div>
        <div class="info-item">
          <label>Linha</label>
          <span>{{ produto.linha }}</span>
        </div>
      </div>
    </div>

    <!-- Corpo: Viewer da Ficha T√©cnica -->
    <div class="detail-body">
      {% if produto.ficha_tecnica_imagem %}
        {% with ft_url=produto.ficha_tecnica_imagem.url %}
          {% with ft_lower=ft_url|lower %}
            {% if ".pdf" in ft_lower %}
              <div class="techsheet-viewer">
                <iframe class="techsheet-frame" src="{{ ft_url }}"></iframe>
              </div>
            {% elif ".jpg" in ft_lower or ".jpeg" in ft_lower or ".png" in ft_lower or ".webp" in ft_lower %}
              <div class="techsheet-viewer">
                <img class="techsheet-img" src="{{ ft_url }}" alt="Ficha t√©cnica - {{ produto.nome_produto }}">
              </div>
            {% else %}
              <div class="empty-techsheet">
                <p>N√£o foi poss√≠vel exibir a ficha t√©cnica neste formato.</p>
                <a class="btn btn-download" href="{{ ft_url }}" download>‚¨áÔ∏è Baixar Arquivo</a>
              </div>
            {% endif %}
          {% endwith %}
        {% endwith %}
      {% else %}
        <div class="empty-techsheet">
          <p style="font-size: 16px; margin-bottom: 8px;">üìÑ</p>
          <p>Nenhuma ficha t√©cnica cadastrada para este produto.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}